{% extends "base.html" %}

{% block title %}Student Login - ExamPortal{% endblock %}

{% block content %}
<!-- Center wrapper: fills the available main area (so footer stays fixed at bottom) -->
<div class="center-vert">
  <div class="container">
      <div class="row justify-content-center">
          <div class="col-md-4">
              <div class="card login-card">
                  <div class="card-body p-4">
                      <div class="text-center mb-4">
                          <i class="fas fa-graduation-cap fa-3x text-primary mb-3"></i>
                          <h3 class="card-title text-white">Student Login</h3>
                          <p style="color: #e9ecef;">Access your exam portal</p>
                      </div>

                      <!-- Flash Messages -->
                      {% with messages = get_flashed_messages(with_categories=true) %}
                          {% if messages %}
                              {% for category, message in messages %}
                                  <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show">
                                      <i class="fas fa-{{ 'exclamation-triangle' if category == 'error' else 'check-circle' if category == 'success' else 'info-circle' }}"></i>
                                      {{ message }}
                                      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                  </div>
                              {% endfor %}
                          {% endif %}
                      {% endwith %}

                      <form method="POST" id="loginForm">
                          <div class="mb-3">
                              <label for="username" class="form-label text-white">
                                  <i class="fas fa-user"></i> Username or Email
                              </label>
                              <div class="input-group">
                                  <span class="input-group-text">
                                      <i class="fas fa-user text-primary"></i>
                                  </span>
                                  <input type="text"
                                         class="form-control"
                                         id="username"
                                         name="username"
                                         placeholder="Enter username or email"
                                         required
                                         autocomplete="username">
                              </div>
                          </div>

                          <div class="mb-3">
                              <label for="password" class="form-label text-white">
                                  <i class="fas fa-lock"></i> Password
                              </label>
                              <div class="input-group">
                                  <span class="input-group-text">
                                      <i class="fas fa-lock text-primary"></i>
                                  </span>
                                  <input type="password"
                                         class="form-control"
                                         id="password"
                                         name="password"
                                         placeholder="Enter your password"
                                         required
                                         autocomplete="current-password">
                                  <button class="btn btn-outline-secondary" type="button" onclick="togglePassword()">
                                      <i class="fas fa-eye" id="toggleIcon"></i>
                                  </button>
                              </div>
                          </div>

                          <button type="submit" class="btn btn-primary w-100 mb-3" id="loginBtn">
                              <i class="fas fa-sign-in-alt"></i>
                              <span id="loginText">Login</span>
                              <span id="loginSpinner" class="d-none">
                                  <i class="fas fa-spinner fa-spin"></i> Logging in...
                              </span>
                          </button>
                      </form>

                      <!-- Links Section -->
                      <div class="text-center mt-3">
                          <a href="{{ url_for('forgot_password') }}" class="text-decoration-none text-info">
                              <i class="fas fa-user-plus"></i> Register New Account
                          </a>
                      </div>

                      <div class="text-center mt-3">
                        <a href="{{ url_for('admin.login') }}" class="btn btn-sm btn-outline-dark" style="color: #e9ecef;">
                          <i class="fas fa-user-shield"></i> Login as Admin
                        </a>
                      </div>

                      <!-- Help Section -->
                      <div class="mt-4">
                          <div class="alert alert-info">
                              <h6><i class="fas fa-info-circle"></i> Need Help?</h6>
                              <ul class="mb-0 small">
                                  <li><strong>New Student:</strong> Click "Register New Account" to create account</li>
                                  <li><strong>Existing Student:</strong> Use your username/email and password</li>
                                  <li><strong>Login Issues:</strong> Contact your administrator</li>
                              </ul>
                          </div>
                      </div>

                      <div class="text-center mt-3">
                          <small style="color: #60a5fa;">
                              <i class="fas fa-shield-alt" style="color: #60a5fa;"></i>
                              Secure login powered by ExamPortal
                          </small>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </div>
</div>

<script>
// Toggle password visibility
function togglePassword() {
    const password = document.getElementById('password');
    const toggleIcon = document.getElementById('toggleIcon');

    if (password.type === 'password') {
        password.type = 'text';
        toggleIcon.classList.replace('fa-eye', 'fa-eye-slash');
    } else {
        password.type = 'password';
        toggleIcon.classList.replace('fa-eye-slash', 'fa-eye');
    }
}

// Form submission handling
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('loginForm');
    const loginBtn = document.getElementById('loginBtn');
    const loginText = document.getElementById('loginText');
    const loginSpinner = document.getElementById('loginSpinner');

    form.addEventListener('submit', function() {
        loginBtn.disabled = true;
        loginText.classList.add('d-none');
        loginSpinner.classList.remove('d-none');
    });

    // Auto-dismiss alerts
    setTimeout(function() {
        const alerts = document.querySelectorAll('.alert-dismissible');
        alerts.forEach(function(alert) {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
        });
    }, 500);

    // Enter key handling
    document.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            form.submit();
        }
    });
});
</script>

<style>
/* Ensure the center wrapper takes the available main height and centers content */
.center-vert {
  min-height: calc(105vh - 160px); /* shrink for header+footer; tweak 160px if your header/footer heights differ */
  display: flex;
  align-items: center;
  justify-content: center;
}

/* keep the rest of your original styles unchanged */
.login-card {
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
    border: 1px solid #334155;
    background: rgba(30, 41, 59, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 1rem;
}

.card-title {
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.form-control:focus {
    border-color: #6366f1;
    box-shadow: 0 0 0 0.2rem rgba(99, 102, 241, 0.25);
}

.input-group-text {
    background: rgba(30, 41, 59, 0.8);
    border-color: #334155;
}

.btn-outline-secondary {
    border-color: #334155;
    color: #94a3b8;
}

.btn-outline-secondary:hover {
    background-color: #334155;
    border-color: #334155;
    color: #f1f5f9;
}

.alert-info {
    background: rgba(59, 130, 246, 0.1);
    border-left: 4px solid #3b82f6;
    color: #93c5fd;
    border: none;
}

.text-warning {
    color: #fbbf24 !important;
}

.text-info {
    color: #60a5fa !important;
}

.btn-primary:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

@media (max-width: 768px) {
    .col-md-4 {
        margin: 0 1rem;
    }

    .card-body {
        padding: 2rem 1.5rem;
    }

    .row.text-center a {
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
        display: inline-block;
    }
}

/* Loading animation */
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.fa-spinner.fa-spin {
    animation: spin 1s linear infinite;
}
</style>
{% endblock %}